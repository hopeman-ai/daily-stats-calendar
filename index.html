<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš”ì¦˜ ì–´ë•Œ?</title>

    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="ìš”ì¦˜ ì–´ë•Œ?" />
    <meta property="og:description" content="ë‚˜ë¥¼ ë³´ëŠ” ìº˜ë¦°ë”" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://hopeman-ai.github.io/daily-stats-calendar/" />
    <meta property="og:image" content="https://hopeman-ai.github.io/daily-stats-calendar/now-icon.png" />
    <meta name="description" content="ìš”ì¦˜ ì–´ë•Œ? - ë‚˜ë¥¼ ë³´ëŠ” ìº˜ë¦°ë”" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 10px;
        }

        .container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            line-height: 1.2;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5em;
        }

        .title-icon {
            width: 1.45em;
            height: 1.45em;
            flex-shrink: 0;
            object-fit: contain;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 8px 15px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 14px;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        .calendar-header button {
            padding: 6px 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        .calendar-header button:hover {
            background: #45a049;
        }

        .calendar-header h2 {
            color: #333;
            font-size: 1.1rem;
            text-align: center;
            flex: 1;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            width: 100%;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 5px 2px;
            color: #666;
            font-size: 11px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            padding: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
        }

        .calendar-day:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        .calendar-day.empty {
            cursor: default;
            background: #fafafa;
        }

        .calendar-day.empty:hover {
            transform: none;
        }

        .calendar-day.today {
            border: 2px solid #4CAF50;
        }

        .calendar-day.has-data {
            background: #e8f5e9;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 2px;
            font-size: 11px;
        }

        .day-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 10px;
        }

        /* ì…ë ¥ ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-header h2 {
            font-size: 1.2rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .energy-options {
            display: flex;
            gap: 6px;
        }

        .energy-btn {
            flex: 1;
            padding: 10px 4px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .energy-btn:hover {
            border-color: #4CAF50;
        }

        .energy-btn.selected {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .save-btn {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 15px;
            cursor: pointer;
        }

        .save-btn:hover {
            background: #45a049;
        }

        .delete-btn {
            width: 100%;
            padding: 10px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .delete-btn:hover {
            background: #da190b;
        }

        .help-text {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }

        /* í†µê³„ ìŠ¤íƒ€ì¼ */
        .stats-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .period-btn {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
        }

        .period-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .stats-section {
            margin-bottom: 25px;
        }

        .stats-section h3 {
            color: #333;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .insight {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            line-height: 1.5;
            color: #1976d2;
            font-size: 13px;
        }

        .energy-chart {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .energy-bar {
            flex: 1;
            text-align: center;
        }

        .bar {
            height: 150px;
            background: #e0e0e0;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: #4CAF50;
            transition: height 0.3s;
        }

        .bar-fill.high {
            background: #4CAF50;
        }

        .bar-fill.medium {
            background: #FFC107;
        }

        .bar-fill.low {
            background: #f44336;
        }

        .bar-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 14px;
        }

        .bar-label {
            margin-top: 8px;
            font-weight: bold;
            font-size: 12px;
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .tag-item {
            background: #4CAF50;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
        }

        .tag-count {
            background: rgba(255,255,255,0.3);
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 4px;
        }

        /* ìš”ì•½ ê²°ê³¼ ëª¨ë‹¬ */
        .summary-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
        }

        .summary-modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .summary-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .summary-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .summary-header h2 {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 5px;
        }

        .summary-header .sub-title {
            font-size: 0.9rem;
            color: #999;
        }

        .summary-text {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.8;
            font-size: 15px;
            color: #333;
            margin-bottom: 20px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .summary-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .summary-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .summary-btn:hover {
            background: #f5f5f5;
            border-color: #4CAF50;
        }

        .summary-btn.primary {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .summary-btn.primary:hover {
            background: #45a049;
        }

        .summary-close {
            width: 100%;
            padding: 10px;
            background: #e0e0e0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .summary-close:hover {
            background: #d0d0d0;
        }

        .share-canvas {
            display: none;
        }

        .saved-summary {
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }

        .saved-summary-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .saved-summary-text {
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }

        /* Copyright */
        .copyright {
            text-align: center;
            color: #999;
            font-size: 11px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        /* ë°ìŠ¤í¬í†± ìµœì í™” (768px ì´ìƒ) */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                padding: 30px;
            }

            h1 {
                font-size: 2rem;
                margin-bottom: 30px;
                gap: 0.6em;
            }

            .title-icon {
                width: 1.6em;
                height: 1.6em;
            }

            .tabs {
                gap: 10px;
                margin-bottom: 30px;
            }

            .tab {
                padding: 10px 20px;
                font-size: 16px;
            }

            .calendar-header {
                margin-bottom: 20px;
            }

            .calendar-header button {
                padding: 8px 15px;
                font-size: 14px;
            }

            .calendar-header h2 {
                font-size: 1.5rem;
            }

            .calendar-grid {
                gap: 10px;
            }

            .calendar-day-header {
                padding: 10px;
                font-size: 14px;
            }

            .calendar-day {
                padding: 10px;
                border-radius: 5px;
            }

            .day-number {
                font-size: 14px;
                margin-bottom: 5px;
            }

            .day-indicator {
                font-size: 12px;
                bottom: 5px;
                right: 5px;
            }

            .stats-controls {
                gap: 10px;
                margin-bottom: 30px;
            }

            .period-btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            .stats-section {
                margin-bottom: 30px;
            }

            .stats-section h3 {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }

            .insight {
                padding: 15px;
                font-size: 14px;
                margin-bottom: 10px;
            }

            .energy-chart {
                gap: 20px;
                margin: 20px 0;
            }

            .bar {
                height: 200px;
            }

            .bar-value {
                font-size: 18px;
            }

            .bar-label {
                margin-top: 10px;
                font-size: 14px;
            }

            .tag-list {
                gap: 10px;
                margin-top: 15px;
            }

            .tag-item {
                padding: 8px 15px;
                font-size: 14px;
            }

            .tag-count {
                padding: 2px 8px;
                margin-left: 5px;
            }

            .modal-content {
                padding: 30px;
            }

            .modal-header {
                margin-bottom: 20px;
            }

            .modal-header h2 {
                font-size: 1.5rem;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .energy-options {
                gap: 10px;
            }

            .energy-btn {
                padding: 12px;
                font-size: 14px;
            }

            .save-btn {
                font-size: 16px;
            }

            .delete-btn {
                margin-top: 10px;
            }

            .help-text {
                font-size: 12px;
                margin-top: 5px;
            }

            .summary-content {
                padding: 35px;
            }

            .summary-header h2 {
                font-size: 1.5rem;
            }

            .summary-text {
                padding: 25px;
                font-size: 16px;
            }

            .summary-btn {
                padding: 14px;
                font-size: 15px;
            }

            .saved-summary {
                padding: 18px;
            }

            .saved-summary-label {
                font-size: 13px;
            }

            .saved-summary-text {
                font-size: 15px;
            }

            .copyright {
                font-size: 12px;
                margin-top: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <img src="now-icon.png" alt="Calendar" class="title-icon">
            ìš”ì¦˜ ì–´ë•Œ?
        </h1>

        <div class="tabs">
            <button class="tab active" data-view="calendar">ìº˜ë¦°ë”</button>
            <button class="tab" data-view="stats">í†µê³„</button>
        </div>

        <!-- ìº˜ë¦°ë” ë·° -->
        <div id="calendar-view" class="view active">
            <div class="calendar-header">
                <button id="prev-month">â—€ ì´ì „</button>
                <h2 id="current-month"></h2>
                <button id="next-month">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="calendar-grid" id="calendar-grid"></div>
        </div>

        <!-- í†µê³„ ë·° -->
        <div id="stats-view" class="view">
            <div class="stats-controls">
                <button class="period-btn active" data-period="7">ìµœê·¼ 7ì¼</button>
                <button class="period-btn" data-period="30">ìµœê·¼ 30ì¼</button>
            </div>
            <div id="stats-content"></div>
        </div>

        <div class="copyright">
            Copyright 2026. Heeseok Choi
        </div>
    </div>

    <!-- ì…ë ¥ ëª¨ë‹¬ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">ë‚ ì§œ ê¸°ë¡</h2>
                <button class="close-btn" id="close-modal">Ã—</button>
            </div>

            <form id="record-form">
                <div class="form-group">
                    <label>ì—ë„ˆì§€ ìƒíƒœ</label>
                    <div class="energy-options">
                        <button type="button" class="energy-btn" data-energy="ë†’ìŒ">ë†’ìŒ ğŸ”¥</button>
                        <button type="button" class="energy-btn" data-energy="ë³´í†µ">ë³´í†µ âš¡</button>
                        <button type="button" class="energy-btn" data-energy="ë‚®ìŒ">ë‚®ìŒ ğŸŒ™</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>í•˜ë£¨ íƒœê·¸</label>
                    <input type="text" id="tags-input" placeholder="#ì§‘ì¤‘ #íœ´ì‹" />
                    <div class="help-text">#ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” íƒœê·¸ë¥¼ 1~2ê°œ ì…ë ¥í•˜ì„¸ìš”</div>
                </div>

                <div class="form-group">
                    <label>ë©”ëª¨ (ì„ íƒ)</label>
                    <textarea id="memo-input" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ í•œ ì¤„ë¡œ ê¸°ë¡í•´ë³´ì„¸ìš”"></textarea>
                </div>

                <!-- ì €ì¥ëœ ìš”ì•½ í‘œì‹œ -->
                <div id="saved-summary-container" style="display:none;">
                    <div class="saved-summary">
                        <div class="saved-summary-label">ì˜¤ëŠ˜ì˜ í•œ ë¬¸ì¥</div>
                        <div class="saved-summary-text" id="saved-summary-text"></div>
                    </div>
                </div>

                <button type="submit" class="save-btn">ì €ì¥</button>
                <button type="button" class="delete-btn" id="delete-btn" style="display:none;">ì‚­ì œ</button>
            </form>
        </div>
    </div>

    <!-- ìš”ì•½ ê²°ê³¼ ëª¨ë‹¬ -->
    <div id="summary-modal" class="summary-modal">
        <div class="summary-content">
            <div class="summary-header">
                <h2>ì˜¤ëŠ˜ì˜ í•œ ë¬¸ì¥</h2>
                <p class="sub-title">ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤</p>
            </div>

            <div class="summary-text" id="summary-text"></div>

            <div class="summary-actions">
                <button class="summary-btn" id="copy-summary-btn">ğŸ“‹ ë¬¸ì¥ ë³µì‚¬</button>
                <button class="summary-btn" id="share-summary-btn">ğŸ“¤ ì›í•˜ë©´ ê³µìœ </button>
            </div>

            <button class="summary-close" id="close-summary-modal">í™•ì¸</button>
        </div>
    </div>

    <!-- ê³µìœ ìš© ìº”ë²„ìŠ¤ (ìˆ¨ê¹€) -->
    <canvas id="share-canvas" class="share-canvas" width="800" height="600"></canvas>

    <script>
        class DailyStatsApp {
            constructor() {
                this.currentDate = new Date();
                this.selectedDate = null;
                this.currentView = 'calendar';
                this.statsPeriod = 7;
                this.init();
            }

            init() {
                this.loadData();
                this.renderCalendar();
                this.bindEvents();
            }

            loadData() {
                const stored = localStorage.getItem('dailyStats');
                this.data = stored ? JSON.parse(stored) : {};
            }

            saveData() {
                localStorage.setItem('dailyStats', JSON.stringify(this.data));
            }

            getDateKey(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            }

            renderCalendar() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();

                document.getElementById('current-month').textContent = `${year}ë…„ ${month + 1}ì›”`;

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDay = firstDay.getDay();
                const totalDays = lastDay.getDate();

                const grid = document.getElementById('calendar-grid');
                grid.innerHTML = '';

                // ìš”ì¼ í—¤ë”
                ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'calendar-day-header';
                    header.textContent = day;
                    grid.appendChild(header);
                });

                // ë¹ˆ ì¹¸
                for (let i = 0; i < startDay; i++) {
                    const empty = document.createElement('div');
                    empty.className = 'calendar-day empty';
                    grid.appendChild(empty);
                }

                // ë‚ ì§œ
                const today = new Date();
                for (let day = 1; day <= totalDays; day++) {
                    const date = new Date(year, month, day);
                    const dateKey = this.getDateKey(date);
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day';

                    if (date.toDateString() === today.toDateString()) {
                        dayEl.classList.add('today');
                    }

                    if (this.data[dateKey]) {
                        dayEl.classList.add('has-data');
                        const indicator = document.createElement('div');
                        indicator.className = 'day-indicator';
                        const energy = this.data[dateKey].energy;
                        indicator.textContent = energy === 'ë†’ìŒ' ? 'ğŸ”¥' : energy === 'ë³´í†µ' ? 'âš¡' : 'ğŸŒ™';
                        dayEl.appendChild(indicator);
                    }

                    const number = document.createElement('div');
                    number.className = 'day-number';
                    number.textContent = day;
                    dayEl.appendChild(number);

                    dayEl.addEventListener('click', () => this.openModal(date));
                    grid.appendChild(dayEl);
                }
            }

            openModal(date) {
                this.selectedDate = date;
                const dateKey = this.getDateKey(date);
                const record = this.data[dateKey];

                document.getElementById('modal-title').textContent =
                    `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;

                // í¼ ì´ˆê¸°í™”
                document.querySelectorAll('.energy-btn').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('tags-input').value = '';
                document.getElementById('memo-input').value = '';

                // ì €ì¥ëœ ìš”ì•½ ì´ˆê¸°í™”
                const savedSummaryContainer = document.getElementById('saved-summary-container');
                savedSummaryContainer.style.display = 'none';

                // ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
                if (record) {
                    const energyBtn = document.querySelector(`[data-energy="${record.energy}"]`);
                    if (energyBtn) energyBtn.classList.add('selected');
                    document.getElementById('tags-input').value = record.tags.join(' ');
                    document.getElementById('memo-input').value = record.memo || '';
                    document.getElementById('delete-btn').style.display = 'block';

                    // ì €ì¥ëœ ìš”ì•½ í‘œì‹œ
                    if (record.summary) {
                        document.getElementById('saved-summary-text').textContent = record.summary;
                        savedSummaryContainer.style.display = 'block';
                    }
                } else {
                    document.getElementById('delete-btn').style.display = 'none';
                }

                document.getElementById('modal').classList.add('active');
            }

            closeModal() {
                document.getElementById('modal').classList.remove('active');
            }

            saveRecord(e) {
                e.preventDefault();

                const selectedEnergy = document.querySelector('.energy-btn.selected');
                if (!selectedEnergy) {
                    alert('ì—ë„ˆì§€ ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                    return;
                }

                const energy = selectedEnergy.dataset.energy;
                const tagsInput = document.getElementById('tags-input').value;
                const tags = tagsInput.split(/\s+/).filter(t => t.startsWith('#')).slice(0, 2);
                const memo = document.getElementById('memo-input').value.trim();

                if (tags.length === 0) {
                    alert('íƒœê·¸ë¥¼ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš” (#ìœ¼ë¡œ ì‹œì‘)');
                    return;
                }

                const dateKey = this.getDateKey(this.selectedDate);
                const existingRecord = this.data[dateKey];

                // ìš”ì•½ ë¬¸ì¥ ìƒì„±
            generateDailySummary(energy, tags, memo) {
            console.log('ğŸ”„ ìš”ì•½ ìƒì„± ì‹œì‘ - ì—ë„ˆì§€:', energy, 'íƒœê·¸:', tags, 'ë©”ëª¨:', memo);
            const recentContext = this.analyzeRecentDays(7);
            const cleanTags = tags.map(tag => tag.replace('#', ''));
            const context = {
            today: {
            energy: energy,
            tags: cleanTags,
            memo: memo
            },
            recent: recentContext,
            selectedDate: this.selectedDate
            };
            const summary = this.generateWarmSentence(context);
            console.log('âœ… ìš”ì•½ ìƒì„± ì™„ë£Œ:', summary);
            return summary;
            }
            analyzeRecentDays(days) {
            const today = this.selectedDate;
            const recentRecords = [];
            const energyTrend = [];
            const tagFrequency = {};
            for (let i = 1; i <= days; i++) {
            const date = new Date(today);
            date.setDate(date.getDate() - i);
            const dateKey = this.getDateKey(date);
            if (this.data[dateKey]) {
            const record = this.data[dateKey];
            recentRecords.push(record);
            energyTrend.push(record.energy);
            record.tags.forEach(tag => {
            const cleanTag = tag.replace('#', '');
            tagFrequency[cleanTag] = (tagFrequency[cleanTag] || 0) + 1;
            });
            }
            }
            const lowCount = energyTrend.filter(e => e === 'ë‚®ìŒ').length;
            const highCount = energyTrend.filter(e => e === 'ë†’ìŒ').length;
            const totalCount = energyTrend.length;
            let energyPattern = 'neutral';
            if (totalCount >= 2) {
            if (lowCount / totalCount > 0.6) energyPattern = 'mostly_low';
            else if (highCount / totalCount > 0.6) energyPattern = 'mostly_high';
            else if (lowCount >= 2) energyPattern = 'some_low';
            }
            const frequentTags = Object.entries(tagFrequency)
            .filter(([tag, count]) => count >= 2)
            .sort((a, b) => b[1] - a[1])
            .map(([tag]) => tag);
            return {
            hasRecentData: recentRecords.length > 0,
            recordCount: recentRecords.length,
            energyPattern: energyPattern,
            frequentTags: frequentTags.slice(0, 3),
            lastEnergy: energyTrend[0] || null
            };
            }
            generateWarmSentence(context) {
            const { today, recent } = context;
            const { energy, tags, memo } = today;
            const sentiment = this.analyzeSentiment(memo);
            const seed = this.selectedDate.getDate() + this.selectedDate.getMonth() * 31;
            let sentence = '';
            if (recent.hasRecentData && recent.recordCount >= 2) {
            sentence = this.generateContextualSentence(today, recent, sentiment, seed);
            } else {
            sentence = this.generateStandaloneSentence(today, sentiment, seed);
            }
            return sentence;
            }
            analyzeSentiment(memo) {
            if (!memo) return 'neutral';
            const positiveWords = ['ì¢‹', 'í–‰ë³µ', 'ê¸°ì¨', 'ì¦ê±°', 'ë§Œì¡±', 'ì„±ê³µ', 'ì˜'];
            const negativeWords = ['í˜ë“¤', 'í”¼ê³¤', 'ì§€ì¹¨', 'ì–´ë ¤', 'ì•„ì‰¬', 'ì‹¤ë§', 'ë¶ˆì•ˆ', 'ë²„ê±°'];
            const neutralWords = ['ìƒê°', 'ê³ ë¯¼', 'ì •ë¦¬', 'ê³„íš', 'ì¤€ë¹„'];
            const memoLower = memo.toLowerCase();
            const hasPositive = positiveWords.some(word => memoLower.includes(word));
            const hasNegative = negativeWords.some(word => memoLower.includes(word));
            const hasNeutral = neutralWords.some(word => memoLower.includes(word));
            if (hasNegative) return 'difficult';
            if (hasPositive) return 'positive';
            if (hasNeutral) return 'thoughtful';
            return 'neutral';
            }
            generateContextualSentence(today, recent, sentiment, seed) {
            const { energy, tags } = today;
            const patterns = [];
            if (recent.energyPattern === 'mostly_low' && energy === 'ë‚®ìŒ') {
            patterns.push(
            'ìš”ì¦˜ ê³„ì† í˜ë“  ì‹œê°„ì´ì—ˆë˜ ê±¸ ìƒê°í•˜ë©´, ì˜¤ëŠ˜ë„ ì‰½ì§€ ì•Šì•˜ì„ ê²ƒ ê°™ì•„. ê·¸ë˜ë„ ì—¬ê¸°ê¹Œì§€ ì˜¨ ê±¸ë¡œ ì¶©ë¶„í•´.',
            'ìµœê·¼ ë©°ì¹ ì„ ë³´ë©´, ì˜¤ëŠ˜ë„ ë²„í‹°ëŠ” ê²ƒ ìì²´ê°€ ì• ì“´ ê±°ì•¼.',
            'ìš”ì¦˜ íë¦„ ì†ì—ì„œ ì˜¤ëŠ˜ë„ í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í–ˆë‹¤ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ê´œì°®ì•„.'
            );
            } else if (recent.energyPattern === 'mostly_low' && energy !== 'ë‚®ìŒ') {
            patterns.push(
            'ìš”ì¦˜ í˜ë“¤ì—ˆë˜ ê²ƒ ê°™ì€ë°, ì˜¤ëŠ˜ì€ ì¡°ê¸ˆ ë‚˜ì•„ì§„ ê²ƒ ê°™ì•„ ë‹¤í–‰ì´ì•¼.',
            'ìµœê·¼ ë©°ì¹ ì„ ìƒê°í•˜ë©´, ì˜¤ëŠ˜ì€ ì¡°ê¸ˆ ìˆ¨í†µì´ íŠ¸ì¸ ëŠë‚Œì´ì•¼.',
            'ìš”ì¦˜ ê³„ì† ë²„ê±°ì› ëŠ”ë°, ì˜¤ëŠ˜ì€ ê·¸ë˜ë„ ê´œì°®ì€ í•˜ë£¨ì˜€ë˜ ê²ƒ ê°™ì•„.'
            );
            }
            else if (recent.energyPattern === 'mostly_high' && energy === 'ë†’ìŒ') {
            patterns.push(
            'ìš”ì¦˜ ê³„ì† ë°”ì˜ê²Œ ë‹¬ë ¤ì˜¨ ê²ƒ ê°™ì•„. ì˜¤ëŠ˜ë„ ì—´ì‹¬íˆ ë³´ëƒˆêµ¬ë‚˜.',
            'ìµœê·¼ íë¦„ì„ ë³´ë©´, ì˜¤ëŠ˜ë„ ì§‘ì¤‘í•´ì„œ í•˜ë£¨ë¥¼ ì±„ìš´ ê²ƒ ê°™ì•„.',
            'ìš”ì¦˜ ê³„ì† ì›€ì§ì´ê³  ìˆì—ˆëŠ”ë°, ì˜¤ëŠ˜ë„ ê·¸ íë¦„ì´ ì´ì–´ì§„ í•˜ë£¨ì•¼.'
            );
            } else if (recent.energyPattern === 'mostly_high' && energy === 'ë‚®ìŒ') {
            patterns.push(
            'ìš”ì¦˜ ê³„ì† ë°”ë¹´ë˜ ê±¸ ìƒê°í•˜ë©´, ì˜¤ëŠ˜ì€ ì¢€ ì‰¬ê³  ì‹¶ì—ˆì„ ê²ƒ ê°™ì•„.',
            'ìµœê·¼ ê³„ì† ë‹¬ë ¤ì™”ìœ¼ë‹ˆ, ì˜¤ëŠ˜ì€ í”¼ê³¤í–ˆì„ ë§Œë„ í•´.',
            'ìš”ì¦˜ íë¦„ì„ ë³´ë©´, ì˜¤ëŠ˜ì€ í•œìˆ¨ ëŒë¦¬ëŠ” ì‹œê°„ì´ í•„ìš”í–ˆë˜ ê²ƒ ê°™ì•„.'
            );
            }
            else if (recent.frequentTags.length > 0) {
            const repeatedTag = recent.frequentTags[0];
            const todayHasTag = tags.some(t => t === repeatedTag);
            if (todayHasTag) {
            patterns.push(
            `ìš”ì¦˜ ê³„ì† ${repeatedTag} ì¤‘ì‹¬ìœ¼ë¡œ í•˜ë£¨ë¥¼ ë³´ë‚´ê³  ìˆëŠ” ê²ƒ ê°™ì•„. ì˜¤ëŠ˜ë„ ê·¸ëŸ° í•˜ë£¨ì˜€êµ¬ë‚˜.`,
            `ìµœê·¼ ë©°ì¹ ì„ ë³´ë©´, ${repeatedTag}ì´ ê³„ì† ë„ˆì˜ ì£¼ìš” ê´€ì‹¬ì‚¬ì˜€ë˜ ê²ƒ ê°™ì•„.`,
            `ìš”ì¦˜ ${repeatedTag}ì— ì§‘ì¤‘í•˜ê³  ìˆëŠ” ê²ƒ ê°™ì•„. ì˜¤ëŠ˜ë„ ê·¸ íë¦„ ì†ì— ìˆì—ˆêµ¬ë‚˜.`
            );
            } else {
            patterns.push(
            `ìš”ì¦˜ì€ ì£¼ë¡œ ${repeatedTag}ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë³´ëƒˆëŠ”ë°, ì˜¤ëŠ˜ì€ ì¡°ê¸ˆ ë‹¤ë¥¸ í•˜ë£¨ì˜€ë˜ ê²ƒ ê°™ì•„.`,
            `ìµœê·¼ íë¦„ê³¼ëŠ” ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ, ì˜¤ëŠ˜ì€ ë‚˜ë¦„ì˜ í•˜ë£¨ë¥¼ ë³´ë‚¸ ê²ƒ ê°™ì•„.`
            );
            }
            }
            else {
            if (sentiment === 'difficult') {
            patterns.push(
            'ìš”ì¦˜ íë¦„ ì†ì—ì„œ ì˜¤ëŠ˜ë„ ì‰½ì§€ ì•Šì€ í•˜ë£¨ì˜€ë˜ ê²ƒ ê°™ì•„. ê·¸ë˜ë„ ì—¬ê¸°ê¹Œì§€ ì™”ì–´.',
            'ìµœê·¼ ë©°ì¹ ì„ ë³´ë©´, ì˜¤ëŠ˜ë„ ë„ˆ ë‚˜ë¦„ëŒ€ë¡œ í•˜ë£¨ë¥¼ ë²„í…¨ë‚¸ ê²ƒ ê°™ì•„.',
            'ìš”ì¦˜ë„ ê·¸ë ‡ê³  ì˜¤ëŠ˜ë„ ê·¸ë ‡ê³ , ì¡°ìš©íˆ ì• ì“°ê³  ìˆëŠ” ê²ƒ ê°™ì•„.'
            );
            } else if (sentiment === 'positive') {
            patterns.push(
            'ìµœê·¼ ë©°ì¹ ì„ ë³´ë©´, ì˜¤ëŠ˜ë„ ê´œì°®ì€ í•˜ë£¨ë¥¼ ë³´ë‚¸ ê²ƒ ê°™ì•„.',
            'ìš”ì¦˜ íë¦„ ì†ì—ì„œ ì˜¤ëŠ˜ë„ ë‚˜ë¦„ëŒ€ë¡œ ì˜ë¯¸ ìˆëŠ” ì‹œê°„ì´ì—ˆë˜ ê²ƒ ê°™ì•„.',
            'í° ë§ì€ ì—†ì—ˆì§€ë§Œ, ìš”ì¦˜ë„ ì˜¤ëŠ˜ë„ ì˜ ì§€ë‚´ê³  ìˆëŠ” ê²ƒ ê°™ì•„.'
            );
            } else {
            patterns.push(
            'í° ë§ì€ ì—†ì—ˆì§€ë§Œ, ìš”ì¦˜ íë¦„ ì†ì—ì„œ ì˜¤ëŠ˜ë„ ì¡°ìš©íˆ ì• ì“´ í•˜ë£¨ì˜€ë˜ ê²ƒ ê°™ì•„.',
            'ìµœê·¼ ë©°ì¹ ì„ ë³´ë©´, ì˜¤ëŠ˜ë„ ë„ˆ ë‚˜ë¦„ëŒ€ë¡œ í•˜ë£¨ë¥¼ ì±„ìš´ ê²ƒ ê°™ì•„.',
            'ìš”ì¦˜ë„ ê·¸ë ‡ê³  ì˜¤ëŠ˜ë„ ê·¸ë ‡ê³ , ê·¸ëƒ¥ í•˜ë£¨í•˜ë£¨ ì§€ë‚˜ê°€ê³  ìˆêµ¬ë‚˜.',
            'ìµœê·¼ íë¦„ ì†ì—ì„œ ì˜¤ëŠ˜ë„ ì¡°ìš©íˆ í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í–ˆì–´.'
            );
            }
            }
            if (patterns.length === 0) {
            patterns.push(
            'ìµœê·¼ ë©°ì¹ ì„ ë³´ë©´, ì˜¤ëŠ˜ë„ ë„ˆ ë‚˜ë¦„ëŒ€ë¡œ í•˜ë£¨ë¥¼ ë³´ë‚¸ ê²ƒ ê°™ì•„.',
            'ìš”ì¦˜ íë¦„ ì†ì—ì„œ ì˜¤ëŠ˜ë„ í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í–ˆêµ¬ë‚˜.'
            );
            }
            const index = seed % patterns.length;
            return patterns[index];
            }
            generateStandaloneSentence(today, sentiment, seed) {
            const { energy, tags } = today;
            const patterns = [];
            if (energy === 'ë‚®ìŒ') {
            if (sentiment === 'difficult') {
            patterns.push(
            'ì˜¤ëŠ˜ì€ ì‰½ì§€ ì•Šì€ í•˜ë£¨ì˜€ë˜ ê²ƒ ê°™ì•„. ê·¸ë˜ë„ ì—¬ê¸°ê¹Œì§€ ì˜¨ ê±¸ë¡œ ì¶©ë¶„í•´.',
            'í˜ë“  í•˜ë£¨ë¥¼ ë³´ëƒˆêµ¬ë‚˜. ê·¸ê²ƒë§Œìœ¼ë¡œë„ ì˜í•œ ê±°ì•¼.',
            'ë²„ê±°ìš´ í•˜ë£¨ì˜€ì„ ê²ƒ ê°™ì•„. ê³ ìƒí–ˆì–´.'
            );
            } else {
            patterns.push(
            'ì˜¤ëŠ˜ì€ ì¡°ìš©íˆ ì‰¬ì–´ê°€ëŠ” í•˜ë£¨ì˜€ë˜ ê²ƒ ê°™ì•„.',
            'ì˜¤ëŠ˜ì€ ì—ë„ˆì§€ë¥¼ ì•„ë¼ë©° ë³´ë‚¸ í•˜ë£¨ì˜€êµ¬ë‚˜.',
            'í”¼ê³¤í•œ í•˜ë£¨ì˜€ì„ ê²ƒ ê°™ì•„. ê´œì°®ì•„.'
            );
            }
            } else if (energy === 'ë†’ìŒ') {
            patterns.push(
            'ì˜¤ëŠ˜ì€ ì§‘ì¤‘í•´ì„œ í•˜ë£¨ë¥¼ ë³´ë‚¸ ê²ƒ ê°™ì•„.',
            'í™œê¸°ì°¨ê²Œ í•˜ë£¨ë¥¼ ì±„ìš´ ê²ƒ ê°™ì•„.',
            'ì˜¤ëŠ˜ì€ ì—´ì‹¬íˆ ì›€ì§ì¸ í•˜ë£¨ì˜€êµ¬ë‚˜.'
            );
            } else {
            if (sentiment === 'difficult') {
            patterns.push(
            'ì˜¤ëŠ˜ì€ ë‚˜ë¦„ëŒ€ë¡œ ë²„í…¨ë‚¸ í•˜ë£¨ì˜€ë˜ ê²ƒ ê°™ì•„.',
            'ì‰½ì§€ë§Œì€ ì•Šì•˜ì§€ë§Œ, í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í–ˆêµ¬ë‚˜.'
            );
            } else {
            patterns.push(
            'ì˜¤ëŠ˜ë„ ê·¸ëƒ¥ í•˜ë£¨ê°€ ì§€ë‚˜ê°”êµ¬ë‚˜.',
            'ì˜¤ëŠ˜ì€ ê·¸ë ‡ê²Œ í•˜ë£¨ë¥¼ ë³´ëƒˆì–´.',
            'í‰ë²”í•˜ê²Œ í•˜ë£¨ë¥¼ ë§ˆë¬´ë¦¬í–ˆêµ¬ë‚˜.'
            );
            }
            }
            const index = seed % patterns.length;
            return patterns[index];
            }


            deleteRecord() {
                if (confirm('ì´ ë‚ ì˜ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    const dateKey = this.getDateKey(this.selectedDate);
                    delete this.data[dateKey];
                    this.saveData();
                    this.closeModal();
                    this.renderCalendar();
                }
            }

            generateDailySummary(energy, tags, memo) {
                console.log('ğŸ”„ ìš”ì•½ ìƒì„± ì‹œì‘ - ì—ë„ˆì§€:', energy, 'íƒœê·¸:', tags, 'ë©”ëª¨:', memo);

                // ì—ë„ˆì§€ ìƒíƒœ í‘œí˜„
                const energyMap = {
                    'ë†’ìŒ': 'ì—ë„ˆì§€ê°€ ë†’ì•˜ê³ ',
                    'ë³´í†µ': 'ì—ë„ˆì§€ëŠ” ë³´í†µì´ì—ˆê³ ',
                    'ë‚®ìŒ': 'ì—ë„ˆì§€ê°€ ë‚®ì•˜ê³ '
                };

                const energyPhrase = energyMap[energy];

                // íƒœê·¸ ì²˜ë¦¬ (# ì œê±°í•˜ê³  ìì—°ìŠ¤ëŸ½ê²Œ í‘œí˜„)
                const cleanTags = tags.map(tag => tag.replace('#', ''));
                let tagPhrase = '';

                if (cleanTags.length === 1) {
                    tagPhrase = `${cleanTags[0]}`;
                } else if (cleanTags.length === 2) {
                    tagPhrase = `${cleanTags[0]}ì™€ ${cleanTags[1]}`;
                }

                // ë©”ëª¨ ê¸°ë°˜ ë¶„ìœ„ê¸° ê°ì§€ (í‚¤ì›Œë“œ ë¶„ì„)
                let moodModifier = '';
                if (memo) {
                    const positiveWords = ['ì¢‹', 'í–‰ë³µ', 'ê¸°ì¨', 'ì¦ê±°', 'ë§Œì¡±', 'ì„±ê³µ', 'ì˜'];
                    const negativeWords = ['í˜ë“¤', 'í”¼ê³¤', 'ì§€ì¹¨', 'ì–´ë ¤', 'ì•„ì‰¬', 'ì‹¤ë§', 'ë¶ˆì•ˆ'];
                    const neutralWords = ['ìƒê°', 'ê³ ë¯¼', 'ì •ë¦¬', 'ê³„íš', 'ì¤€ë¹„'];

                    const memoLower = memo.toLowerCase();
                    const hasPositive = positiveWords.some(word => memoLower.includes(word));
                    const hasNegative = negativeWords.some(word => memoLower.includes(word));
                    const hasNeutral = neutralWords.some(word => memoLower.includes(word));

                    if (hasNegative) {
                        moodModifier = 'ì— ì§‘ì¤‘í•˜ë©´ì„œë„ ì–´ë ¤ì›€ì´ ìˆì—ˆë˜';
                    } else if (hasPositive) {
                        moodModifier = 'ì— ì§‘ì¤‘í•˜ë©° ë§Œì¡±ìŠ¤ëŸ¬ì› ë˜';
                    } else if (hasNeutral) {
                        moodModifier = 'ì— ëŒ€í•´ ìƒê°í•  ì‹œê°„ì´ ìˆì—ˆë˜';
                    } else {
                        moodModifier = 'ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë³´ë‚¸';
                    }
                } else {
                    moodModifier = 'ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë³´ë‚¸';
                }

                // ë¬¸ì¥ íŒ¨í„´ ì„ íƒ
                const patterns = [
                    `ì˜¤ëŠ˜ì€ ${energyPhrase}, ${tagPhrase}${moodModifier} í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤.`,
                    `${energyPhrase}, ${tagPhrase}${moodModifier} í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤.`
                ];

                // ê°„ë‹¨í•œ ëœë¤ ì„ íƒ (ë‚ ì§œ ê¸°ë°˜ìœ¼ë¡œ ì¼ê´€ì„± ìœ ì§€)
                const patternIndex = this.selectedDate.getDate() % patterns.length;
                const summary = patterns[patternIndex];

                console.log('âœ… ìš”ì•½ ìƒì„± ì™„ë£Œ:', summary);
                return summary;
            }

            showSummaryModal(summary) {
                console.log('ğŸ“ ìš”ì•½ ëª¨ë‹¬ í‘œì‹œ:', summary);
                const summaryModal = document.getElementById('summary-modal');
                const summaryText = document.getElementById('summary-text');

                if (!summaryModal || !summaryText) {
                    console.error('ìš”ì•½ ëª¨ë‹¬ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                summaryText.textContent = summary;
                summaryModal.classList.add('active');
                console.log('âœ… ìš”ì•½ ëª¨ë‹¬ í™œì„±í™” ì™„ë£Œ');
            }

            closeSummaryModal() {
                document.getElementById('summary-modal').classList.remove('active');
            }

            async copySummaryToClipboard() {
                const summaryText = document.getElementById('summary-text').textContent;

                try {
                    await navigator.clipboard.writeText(summaryText);
                    alert('ë¬¸ì¥ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (err) {
                    // í´ë°±: textarea ì‚¬ìš©
                    const textarea = document.createElement('textarea');
                    textarea.value = summaryText;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('ë¬¸ì¥ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }

            generateShareImage() {
                const canvas = document.getElementById('share-canvas');
                const ctx = canvas.getContext('2d');
                const summaryText = document.getElementById('summary-text').textContent;

                // ë°°ê²½
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, 800, 600);

                // ë©”ì¸ í…ìŠ¤íŠ¸ ì˜ì—­
                ctx.fillStyle = '#f5f5f5';
                ctx.fillRect(40, 150, 720, 280);

                // ìš”ì•½ ë¬¸ì¥
                ctx.fillStyle = '#333333';
                ctx.font = '28px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // ê¸´ ë¬¸ì¥ ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                const maxWidth = 680;
                const words = summaryText.split(' ');
                let line = '';
                let y = 290;
                const lineHeight = 40;

                for (let word of words) {
                    const testLine = line + word;
                    const metrics = ctx.measureText(testLine);

                    if (metrics.width > maxWidth && line !== '') {
                        ctx.fillText(line, 400, y);
                        line = word + ' ';
                        y += lineHeight;
                    } else {
                        line = testLine + ' ';
                    }
                }
                ctx.fillText(line, 400, y);

                // í•˜ë‹¨ ì„œë¹„ìŠ¤ëª…
                ctx.fillStyle = '#999999';
                ctx.font = '18px "Segoe UI", sans-serif';
                ctx.fillText('ìš”ì¦˜ ì–´ë•Œ?', 400, 520);

                // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ë˜ëŠ” ê³µìœ 
                canvas.toBlob((blob) => {
                    const file = new File([blob], 'daily-summary.png', { type: 'image/png' });

                    // Web Share API ì§€ì› í™•ì¸
                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        navigator.share({
                            files: [file],
                            title: 'ì˜¤ëŠ˜ì˜ í•œ ë¬¸ì¥',
                            text: summaryText
                        }).catch(err => {
                            // ê³µìœ  ì·¨ì†Œ ì‹œ ë‹¤ìš´ë¡œë“œ
                            this.downloadImage(canvas);
                        });
                    } else {
                        // Web Share API ë¯¸ì§€ì› ì‹œ ë‹¤ìš´ë¡œë“œ
                        this.downloadImage(canvas);
                    }
                });
            }

            downloadImage(canvas) {
                const link = document.createElement('a');
                link.download = 'daily-summary.png';
                link.href = canvas.toDataURL();
                link.click();
                alert('ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }

            renderStats() {
                const days = this.statsPeriod;
                const today = new Date();
                const records = [];

                for (let i = 0; i < days; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateKey = this.getDateKey(date);
                    if (this.data[dateKey]) {
                        records.push(this.data[dateKey]);
                    }
                }

                const statsContent = document.getElementById('stats-content');

                if (records.length === 0) {
                    statsContent.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">ì•„ì§ ê¸°ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                // ì—ë„ˆì§€ ë¶„í¬ ê³„ì‚°
                const energyCount = { 'ë†’ìŒ': 0, 'ë³´í†µ': 0, 'ë‚®ìŒ': 0 };
                const tagCount = {};

                records.forEach(record => {
                    energyCount[record.energy]++;
                    record.tags.forEach(tag => {
                        tagCount[tag] = (tagCount[tag] || 0) + 1;
                    });
                });

                const totalRecords = records.length;
                const topTags = Object.entries(tagCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                // í•´ì„ ìƒì„±
                const insights = this.generateInsights(energyCount, topTags, totalRecords, days);

                // HTML ìƒì„±
                let html = '<div class="stats-section">';
                html += '<h3>ğŸ“Š ê¸°ê°„ ìš”ì•½</h3>';
                insights.forEach(insight => {
                    html += `<div class="insight">${insight}</div>`;
                });
                html += '</div>';

                // ì—ë„ˆì§€ ì°¨íŠ¸
                html += '<div class="stats-section">';
                html += '<h3>âš¡ ì—ë„ˆì§€ ìƒíƒœ ë¶„í¬</h3>';
                html += '<div class="energy-chart">';

                const maxCount = Math.max(...Object.values(energyCount));
                ['ë†’ìŒ', 'ë³´í†µ', 'ë‚®ìŒ'].forEach(energy => {
                    const count = energyCount[energy];
                    const percentage = maxCount > 0 ? (count / maxCount * 100) : 0;
                    const type = energy === 'ë†’ìŒ' ? 'high' : energy === 'ë³´í†µ' ? 'medium' : 'low';
                    const emoji = energy === 'ë†’ìŒ' ? 'ğŸ”¥' : energy === 'ë³´í†µ' ? 'âš¡' : 'ğŸŒ™';

                    html += `
                        <div class="energy-bar">
                            <div class="bar">
                                <div class="bar-fill ${type}" style="height: ${percentage}%"></div>
                                <div class="bar-value">${count}ì¼</div>
                            </div>
                            <div class="bar-label">${emoji} ${energy}</div>
                        </div>
                    `;
                });
                html += '</div></div>';

                // íƒœê·¸ ìˆœìœ„
                if (topTags.length > 0) {
                    html += '<div class="stats-section">';
                    html += '<h3>ğŸ·ï¸ ìì£¼ ë“±ì¥í•œ íƒœê·¸</h3>';
                    html += '<div class="tag-list">';
                    topTags.forEach(([tag, count]) => {
                        html += `<div class="tag-item">${tag} <span class="tag-count">${count}</span></div>`;
                    });
                    html += '</div></div>';
                }

                statsContent.innerHTML = html;
            }

            generateInsights(energyCount, topTags, totalRecords, days) {
                const insights = [];

                // ì—ë„ˆì§€ í•´ì„
                const highRatio = energyCount['ë†’ìŒ'] / totalRecords;
                const lowRatio = energyCount['ë‚®ìŒ'] / totalRecords;

                insights.push(`ìµœê·¼ ${days}ì¼ ì¤‘ ${totalRecords}ì¼ì˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.`);

                if (lowRatio > 0.5) {
                    insights.push('ìµœê·¼ ì—ë„ˆì§€ê°€ ë‚®ì€ ë‚ ì´ ì ˆë°˜ ì´ìƒì„ ì°¨ì§€í–ˆìŠµë‹ˆë‹¤. ì¶©ë¶„í•œ íœ´ì‹ì´ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤.');
                } else if (highRatio > 0.5) {
                    insights.push('ìµœê·¼ ì—ë„ˆì§€ê°€ ë†’ì€ ë‚ ì´ ë§ì•˜ìŠµë‹ˆë‹¤. ì¢‹ì€ ì»¨ë””ì…˜ì„ ìœ ì§€í•˜ê³  ê³„ì‹œë„¤ìš”!');
                } else if (energyCount['ë³´í†µ'] > energyCount['ë†’ìŒ'] && energyCount['ë³´í†µ'] > energyCount['ë‚®ìŒ']) {
                    insights.push('ìµœê·¼ ì—ë„ˆì§€ ìƒíƒœê°€ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤.');
                }

                // íƒœê·¸ í•´ì„
                if (topTags.length > 0) {
                    const [topTag, topCount] = topTags[0];
                    insights.push(`ê°€ì¥ ìì£¼ ë“±ì¥í•œ íƒœê·¸ëŠ” ${topTag} ì…ë‹ˆë‹¤. (${topCount}íšŒ)`);

                    if (topTags.length > 1) {
                        const secondTag = topTags[1][0];
                        insights.push(`${topTag}ì™€ ${secondTag} íŒ¨í„´ì´ ë‘ë“œëŸ¬ì§‘ë‹ˆë‹¤.`);
                    }
                }

                return insights;
            }

            bindEvents() {
                // íƒ­ ì „í™˜
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

                        tab.classList.add('active');
                        const view = tab.dataset.view;
                        document.getElementById(`${view}-view`).classList.add('active');

                        if (view === 'stats') {
                            this.renderStats();
                        }
                    });
                });

                // ì›” ì´ë™
                document.getElementById('prev-month').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.renderCalendar();
                });

                document.getElementById('next-month').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.renderCalendar();
                });

                // ëª¨ë‹¬
                document.getElementById('close-modal').addEventListener('click', () => this.closeModal());
                document.getElementById('modal').addEventListener('click', (e) => {
                    if (e.target.id === 'modal') this.closeModal();
                });

                // ì—ë„ˆì§€ ì„ íƒ
                document.querySelectorAll('.energy-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.energy-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                    });
                });

                // í¼ ì œì¶œ
                document.getElementById('record-form').addEventListener('submit', (e) => this.saveRecord(e));
                document.getElementById('delete-btn').addEventListener('click', () => this.deleteRecord());

                // í†µê³„ ê¸°ê°„ ì„ íƒ
                document.querySelectorAll('.period-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.statsPeriod = parseInt(btn.dataset.period);
                        this.renderStats();
                    });
                });

                // ìš”ì•½ ëª¨ë‹¬ ì´ë²¤íŠ¸
                document.getElementById('close-summary-modal').addEventListener('click', () => this.closeSummaryModal());
                document.getElementById('summary-modal').addEventListener('click', (e) => {
                    if (e.target.id === 'summary-modal') this.closeSummaryModal();
                });

                // ë³µì‚¬ ë²„íŠ¼
                document.getElementById('copy-summary-btn').addEventListener('click', () => this.copySummaryToClipboard());

                // ê³µìœ  ë²„íŠ¼
                document.getElementById('share-summary-btn').addEventListener('click', () => this.generateShareImage());
            }
        }

        // ì•± ì‹œì‘
        window.addEventListener('DOMContentLoaded', () => {
            new DailyStatsApp();
        });
    </script>
</body>
</html>
