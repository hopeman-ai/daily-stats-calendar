<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ìƒ í†µê³„ ìº˜ë¦°ë”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header button {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .calendar-header button:hover {
            background: #45a049;
        }

        .calendar-header h2 {
            color: #333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            color: #666;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .calendar-day:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        .calendar-day.empty {
            cursor: default;
            background: #fafafa;
        }

        .calendar-day.empty:hover {
            transform: none;
        }

        .calendar-day.today {
            border: 2px solid #4CAF50;
        }

        .calendar-day.has-data {
            background: #e8f5e9;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .day-indicator {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 12px;
        }

        /* ì…ë ¥ ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .energy-options {
            display: flex;
            gap: 10px;
        }

        .energy-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .energy-btn:hover {
            border-color: #4CAF50;
        }

        .energy-btn.selected {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .save-btn {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .save-btn:hover {
            background: #45a049;
        }

        .delete-btn {
            width: 100%;
            padding: 10px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #da190b;
        }

        .help-text {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        /* í†µê³„ ìŠ¤íƒ€ì¼ */
        .stats-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .period-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .period-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .stats-section {
            margin-bottom: 30px;
        }

        .stats-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .insight {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            line-height: 1.6;
            color: #1976d2;
        }

        .energy-chart {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .energy-bar {
            flex: 1;
            text-align: center;
        }

        .bar {
            height: 200px;
            background: #e0e0e0;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: #4CAF50;
            transition: height 0.3s;
        }

        .bar-fill.high {
            background: #4CAF50;
        }

        .bar-fill.medium {
            background: #FFC107;
        }

        .bar-fill.low {
            background: #f44336;
        }

        .bar-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 18px;
        }

        .bar-label {
            margin-top: 10px;
            font-weight: bold;
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .tag-item {
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .tag-count {
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“… ì¼ìƒ í†µê³„ ìº˜ë¦°ë”</h1>

        <div class="tabs">
            <button class="tab active" data-view="calendar">ìº˜ë¦°ë”</button>
            <button class="tab" data-view="stats">í†µê³„</button>
        </div>

        <!-- ìº˜ë¦°ë” ë·° -->
        <div id="calendar-view" class="view active">
            <div class="calendar-header">
                <button id="prev-month">â—€ ì´ì „</button>
                <h2 id="current-month"></h2>
                <button id="next-month">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="calendar-grid" id="calendar-grid"></div>
        </div>

        <!-- í†µê³„ ë·° -->
        <div id="stats-view" class="view">
            <div class="stats-controls">
                <button class="period-btn active" data-period="7">ìµœê·¼ 7ì¼</button>
                <button class="period-btn" data-period="30">ìµœê·¼ 30ì¼</button>
            </div>
            <div id="stats-content"></div>
        </div>
    </div>

    <!-- ì…ë ¥ ëª¨ë‹¬ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">ë‚ ì§œ ê¸°ë¡</h2>
                <button class="close-btn" id="close-modal">Ã—</button>
            </div>

            <form id="record-form">
                <div class="form-group">
                    <label>ì—ë„ˆì§€ ìƒíƒœ</label>
                    <div class="energy-options">
                        <button type="button" class="energy-btn" data-energy="ë†’ìŒ">ë†’ìŒ ğŸ”¥</button>
                        <button type="button" class="energy-btn" data-energy="ë³´í†µ">ë³´í†µ âš¡</button>
                        <button type="button" class="energy-btn" data-energy="ë‚®ìŒ">ë‚®ìŒ ğŸŒ™</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>í•˜ë£¨ íƒœê·¸</label>
                    <input type="text" id="tags-input" placeholder="#ì§‘ì¤‘ #íœ´ì‹" />
                    <div class="help-text">#ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” íƒœê·¸ë¥¼ 1~2ê°œ ì…ë ¥í•˜ì„¸ìš”</div>
                </div>

                <div class="form-group">
                    <label>ë©”ëª¨ (ì„ íƒ)</label>
                    <textarea id="memo-input" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ í•œ ì¤„ë¡œ ê¸°ë¡í•´ë³´ì„¸ìš”"></textarea>
                </div>

                <button type="submit" class="save-btn">ì €ì¥</button>
                <button type="button" class="delete-btn" id="delete-btn" style="display:none;">ì‚­ì œ</button>
            </form>
        </div>
    </div>

    <script>
        class DailyStatsApp {
            constructor() {
                this.currentDate = new Date();
                this.selectedDate = null;
                this.currentView = 'calendar';
                this.statsPeriod = 7;
                this.init();
            }

            init() {
                this.loadData();
                this.renderCalendar();
                this.bindEvents();
            }

            loadData() {
                const stored = localStorage.getItem('dailyStats');
                this.data = stored ? JSON.parse(stored) : {};
            }

            saveData() {
                localStorage.setItem('dailyStats', JSON.stringify(this.data));
            }

            getDateKey(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            }

            renderCalendar() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();

                document.getElementById('current-month').textContent = `${year}ë…„ ${month + 1}ì›”`;

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDay = firstDay.getDay();
                const totalDays = lastDay.getDate();

                const grid = document.getElementById('calendar-grid');
                grid.innerHTML = '';

                // ìš”ì¼ í—¤ë”
                ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'calendar-day-header';
                    header.textContent = day;
                    grid.appendChild(header);
                });

                // ë¹ˆ ì¹¸
                for (let i = 0; i < startDay; i++) {
                    const empty = document.createElement('div');
                    empty.className = 'calendar-day empty';
                    grid.appendChild(empty);
                }

                // ë‚ ì§œ
                const today = new Date();
                for (let day = 1; day <= totalDays; day++) {
                    const date = new Date(year, month, day);
                    const dateKey = this.getDateKey(date);
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day';

                    if (date.toDateString() === today.toDateString()) {
                        dayEl.classList.add('today');
                    }

                    if (this.data[dateKey]) {
                        dayEl.classList.add('has-data');
                        const indicator = document.createElement('div');
                        indicator.className = 'day-indicator';
                        const energy = this.data[dateKey].energy;
                        indicator.textContent = energy === 'ë†’ìŒ' ? 'ğŸ”¥' : energy === 'ë³´í†µ' ? 'âš¡' : 'ğŸŒ™';
                        dayEl.appendChild(indicator);
                    }

                    const number = document.createElement('div');
                    number.className = 'day-number';
                    number.textContent = day;
                    dayEl.appendChild(number);

                    dayEl.addEventListener('click', () => this.openModal(date));
                    grid.appendChild(dayEl);
                }
            }

            openModal(date) {
                this.selectedDate = date;
                const dateKey = this.getDateKey(date);
                const record = this.data[dateKey];

                document.getElementById('modal-title').textContent =
                    `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;

                // í¼ ì´ˆê¸°í™”
                document.querySelectorAll('.energy-btn').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('tags-input').value = '';
                document.getElementById('memo-input').value = '';

                // ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
                if (record) {
                    const energyBtn = document.querySelector(`[data-energy="${record.energy}"]`);
                    if (energyBtn) energyBtn.classList.add('selected');
                    document.getElementById('tags-input').value = record.tags.join(' ');
                    document.getElementById('memo-input').value = record.memo || '';
                    document.getElementById('delete-btn').style.display = 'block';
                } else {
                    document.getElementById('delete-btn').style.display = 'none';
                }

                document.getElementById('modal').classList.add('active');
            }

            closeModal() {
                document.getElementById('modal').classList.remove('active');
            }

            saveRecord(e) {
                e.preventDefault();

                const selectedEnergy = document.querySelector('.energy-btn.selected');
                if (!selectedEnergy) {
                    alert('ì—ë„ˆì§€ ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                    return;
                }

                const energy = selectedEnergy.dataset.energy;
                const tagsInput = document.getElementById('tags-input').value;
                const tags = tagsInput.split(/\s+/).filter(t => t.startsWith('#')).slice(0, 2);
                const memo = document.getElementById('memo-input').value.trim();

                if (tags.length === 0) {
                    alert('íƒœê·¸ë¥¼ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš” (#ìœ¼ë¡œ ì‹œì‘)');
                    return;
                }

                const dateKey = this.getDateKey(this.selectedDate);
                this.data[dateKey] = { energy, tags, memo };
                this.saveData();
                this.closeModal();
                this.renderCalendar();
            }

            deleteRecord() {
                if (confirm('ì´ ë‚ ì˜ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    const dateKey = this.getDateKey(this.selectedDate);
                    delete this.data[dateKey];
                    this.saveData();
                    this.closeModal();
                    this.renderCalendar();
                }
            }

            renderStats() {
                const days = this.statsPeriod;
                const today = new Date();
                const records = [];

                for (let i = 0; i < days; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateKey = this.getDateKey(date);
                    if (this.data[dateKey]) {
                        records.push(this.data[dateKey]);
                    }
                }

                const statsContent = document.getElementById('stats-content');

                if (records.length === 0) {
                    statsContent.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">ì•„ì§ ê¸°ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                // ì—ë„ˆì§€ ë¶„í¬ ê³„ì‚°
                const energyCount = { 'ë†’ìŒ': 0, 'ë³´í†µ': 0, 'ë‚®ìŒ': 0 };
                const tagCount = {};

                records.forEach(record => {
                    energyCount[record.energy]++;
                    record.tags.forEach(tag => {
                        tagCount[tag] = (tagCount[tag] || 0) + 1;
                    });
                });

                const totalRecords = records.length;
                const topTags = Object.entries(tagCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                // í•´ì„ ìƒì„±
                const insights = this.generateInsights(energyCount, topTags, totalRecords, days);

                // HTML ìƒì„±
                let html = '<div class="stats-section">';
                html += '<h3>ğŸ“Š ê¸°ê°„ ìš”ì•½</h3>';
                insights.forEach(insight => {
                    html += `<div class="insight">${insight}</div>`;
                });
                html += '</div>';

                // ì—ë„ˆì§€ ì°¨íŠ¸
                html += '<div class="stats-section">';
                html += '<h3>âš¡ ì—ë„ˆì§€ ìƒíƒœ ë¶„í¬</h3>';
                html += '<div class="energy-chart">';

                const maxCount = Math.max(...Object.values(energyCount));
                ['ë†’ìŒ', 'ë³´í†µ', 'ë‚®ìŒ'].forEach(energy => {
                    const count = energyCount[energy];
                    const percentage = maxCount > 0 ? (count / maxCount * 100) : 0;
                    const type = energy === 'ë†’ìŒ' ? 'high' : energy === 'ë³´í†µ' ? 'medium' : 'low';
                    const emoji = energy === 'ë†’ìŒ' ? 'ğŸ”¥' : energy === 'ë³´í†µ' ? 'âš¡' : 'ğŸŒ™';

                    html += `
                        <div class="energy-bar">
                            <div class="bar">
                                <div class="bar-fill ${type}" style="height: ${percentage}%"></div>
                                <div class="bar-value">${count}ì¼</div>
                            </div>
                            <div class="bar-label">${emoji} ${energy}</div>
                        </div>
                    `;
                });
                html += '</div></div>';

                // íƒœê·¸ ìˆœìœ„
                if (topTags.length > 0) {
                    html += '<div class="stats-section">';
                    html += '<h3>ğŸ·ï¸ ìì£¼ ë“±ì¥í•œ íƒœê·¸</h3>';
                    html += '<div class="tag-list">';
                    topTags.forEach(([tag, count]) => {
                        html += `<div class="tag-item">${tag} <span class="tag-count">${count}</span></div>`;
                    });
                    html += '</div></div>';
                }

                statsContent.innerHTML = html;
            }

            generateInsights(energyCount, topTags, totalRecords, days) {
                const insights = [];

                // ì—ë„ˆì§€ í•´ì„
                const highRatio = energyCount['ë†’ìŒ'] / totalRecords;
                const lowRatio = energyCount['ë‚®ìŒ'] / totalRecords;

                insights.push(`ìµœê·¼ ${days}ì¼ ì¤‘ ${totalRecords}ì¼ì˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.`);

                if (lowRatio > 0.5) {
                    insights.push('ìµœê·¼ ì—ë„ˆì§€ê°€ ë‚®ì€ ë‚ ì´ ì ˆë°˜ ì´ìƒì„ ì°¨ì§€í–ˆìŠµë‹ˆë‹¤. ì¶©ë¶„í•œ íœ´ì‹ì´ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤.');
                } else if (highRatio > 0.5) {
                    insights.push('ìµœê·¼ ì—ë„ˆì§€ê°€ ë†’ì€ ë‚ ì´ ë§ì•˜ìŠµë‹ˆë‹¤. ì¢‹ì€ ì»¨ë””ì…˜ì„ ìœ ì§€í•˜ê³  ê³„ì‹œë„¤ìš”!');
                } else if (energyCount['ë³´í†µ'] > energyCount['ë†’ìŒ'] && energyCount['ë³´í†µ'] > energyCount['ë‚®ìŒ']) {
                    insights.push('ìµœê·¼ ì—ë„ˆì§€ ìƒíƒœê°€ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤.');
                }

                // íƒœê·¸ í•´ì„
                if (topTags.length > 0) {
                    const [topTag, topCount] = topTags[0];
                    insights.push(`ê°€ì¥ ìì£¼ ë“±ì¥í•œ íƒœê·¸ëŠ” ${topTag} ì…ë‹ˆë‹¤. (${topCount}íšŒ)`);

                    if (topTags.length > 1) {
                        const secondTag = topTags[1][0];
                        insights.push(`${topTag}ì™€ ${secondTag} íŒ¨í„´ì´ ë‘ë“œëŸ¬ì§‘ë‹ˆë‹¤.`);
                    }
                }

                return insights;
            }

            bindEvents() {
                // íƒ­ ì „í™˜
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

                        tab.classList.add('active');
                        const view = tab.dataset.view;
                        document.getElementById(`${view}-view`).classList.add('active');

                        if (view === 'stats') {
                            this.renderStats();
                        }
                    });
                });

                // ì›” ì´ë™
                document.getElementById('prev-month').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.renderCalendar();
                });

                document.getElementById('next-month').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.renderCalendar();
                });

                // ëª¨ë‹¬
                document.getElementById('close-modal').addEventListener('click', () => this.closeModal());
                document.getElementById('modal').addEventListener('click', (e) => {
                    if (e.target.id === 'modal') this.closeModal();
                });

                // ì—ë„ˆì§€ ì„ íƒ
                document.querySelectorAll('.energy-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.energy-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                    });
                });

                // í¼ ì œì¶œ
                document.getElementById('record-form').addEventListener('submit', (e) => this.saveRecord(e));
                document.getElementById('delete-btn').addEventListener('click', () => this.deleteRecord());

                // í†µê³„ ê¸°ê°„ ì„ íƒ
                document.querySelectorAll('.period-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.statsPeriod = parseInt(btn.dataset.period);
                        this.renderStats();
                    });
                });
            }
        }

        // ì•± ì‹œì‘
        window.addEventListener('DOMContentLoaded', () => {
            new DailyStatsApp();
        });
    </script>
</body>
</html>
